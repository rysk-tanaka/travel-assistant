# Railway ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¬ã‚¤ãƒ‰

> TravelAssistant Discord Botã‚’Railwayã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®è©³ç´°ã‚¬ã‚¤ãƒ‰

## ğŸ“‹ ç›®æ¬¡

- [æ¦‚è¦](#æ¦‚è¦)
- [æ–™é‡‘ä½“ç³»](#æ–™é‡‘ä½“ç³»)
- [äº‹å‰æº–å‚™](#äº‹å‰æº–å‚™)
- [ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †](#ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †)
- [è¨­å®šã¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º](#è¨­å®šã¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º)
- [é‹ç”¨ãƒ»ç›£è¦–](#é‹ç”¨ç›£è¦–)
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
- [ç§»è¡Œè¨ˆç”»](#ç§»è¡Œè¨ˆç”»)

## æ¦‚è¦

Railwayã¯Discord Botå‘ã‘ã«æœ€é©åŒ–ã•ã‚ŒãŸã‚¯ãƒ©ã‚¦ãƒ‰ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚GitHubé€£æºã«ã‚ˆã‚‹è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã€24/7ç¨¼åƒä¿è¨¼ã€ã‚·ãƒ³ãƒ—ãƒ«ãªè¨­å®šãŒç‰¹å¾´ã§ã™ã€‚

### ãªãœRailwayã‚’é¸ã¶ã®ã‹

- **ç°¡å˜ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**: 5åˆ†ã§ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†
- **ä½ã‚³ã‚¹ãƒˆ**: å€‹äººåˆ©ç”¨ãªã‚‰æœˆé¡$1æœªæº€ã‚‚å¯èƒ½
- **å®‰å®šæ€§**: 99.9%ä»¥ä¸Šã®ç¨¼åƒç‡ï¼ˆå®Ÿæ¸¬å€¤ï¼‰
- **Discord Botç‰¹åŒ–**: å…¬å¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤šæ•°

## æ–™é‡‘ä½“ç³»

### ãƒ—ãƒ©ãƒ³è©³ç´°ï¼ˆ2025å¹´1æœˆç¾åœ¨ï¼‰

| ãƒ—ãƒ©ãƒ³ | æœˆé¡åŸºæœ¬æ–™é‡‘ | å«ã¾ã‚Œã‚‹ä½¿ç”¨é‡ | ç‰¹å¾´ |
|--------|-------------|---------------|------|
| Trial | ç„¡æ–™ | $5ï¼ˆä¸€åº¦é™ã‚Šï¼‰ | 30æ—¥é–“æœ‰åŠ¹ |
| Hobby | $5 | $5 | å€‹äººé–‹ç™ºå‘ã‘ |
| Pro | ã‚«ã‚¹ã‚¿ãƒ  | ã‚«ã‚¹ã‚¿ãƒ  | ãƒãƒ¼ãƒ å‘ã‘ |

### å®Ÿéš›ã®ã‚³ã‚¹ãƒˆä¾‹

```text
Discord Botï¼ˆPythonï¼‰1å°é‹ç”¨:
- CPUä½¿ç”¨ç‡: ä½ï¼ˆã‚¢ã‚¤ãƒ‰ãƒ«æ™‚1-2%ï¼‰
- ãƒ¡ãƒ¢ãƒª: 128-256MB
- äºˆæƒ³æœˆé¡: $0.50-$1.00

â€»æ—¥æœ¬ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å®Ÿç¸¾: 2 Boté‹ç”¨ã§æœˆé¡$0.77
```

## äº‹å‰æº–å‚™

### 1. å¿…è¦ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

- [ ] GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- [ ] Railwayã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆGitHubé€£æºæ¨å¥¨ï¼‰
- [ ] Discordé–‹ç™ºè€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- [ ] ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ï¼ˆHobby Planç”¨ï¼‰

### 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```text
travel-assistant/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ bot.py          # ãƒ¡ã‚¤ãƒ³Botå®Ÿè£…
â”‚   â”œâ”€â”€ commands/       # ã‚³ãƒãƒ³ãƒ‰ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â””â”€â”€ utils/          # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ requirements.txt    # Pythonä¾å­˜é–¢ä¿‚
â”œâ”€â”€ runtime.txt         # Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š
â”œâ”€â”€ Procfile           # ãƒ—ãƒ­ã‚»ã‚¹å®šç¾©ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
â”œâ”€â”€ railway.json       # Railwayè¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
â””â”€â”€ .env.example       # ç’°å¢ƒå¤‰æ•°ã‚µãƒ³ãƒ—ãƒ«
```

### 3. å¿…é ˆãƒ•ã‚¡ã‚¤ãƒ«

#### requirements.txt

```txt
discord.py==2.3.2
python-dotenv==1.0.0
aiohttp==3.9.1
PyGithub==2.1.1
anthropic==0.3.0
python-frontmatter==1.0.1
```

#### runtime.txt

```txt
python-3.11.x
```

## ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: GitHubãƒªãƒã‚¸ãƒˆãƒªæº–å‚™

```bash
# ãƒªãƒã‚¸ãƒˆãƒªåˆæœŸåŒ–
cd /Users/rysk/Repositories/rysk/travel-assistant
git init
git add .
git commit -m "Initial commit for Railway deployment"

# GitHubã«ãƒ—ãƒƒã‚·ãƒ¥
git remote add origin https://github.com/yourusername/travel-assistant.git
git push -u origin main
```

### ã‚¹ãƒ†ãƒƒãƒ—2: Railway ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

1. [Railway.app](https://railway.app)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. "Start a New Project" ã‚’ã‚¯ãƒªãƒƒã‚¯
3. "Deploy from GitHub repo" ã‚’é¸æŠ
4. `travel-assistant` ãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠ

### ã‚¹ãƒ†ãƒƒãƒ—3: ç’°å¢ƒå¤‰æ•°è¨­å®š

Railway ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ä»¥ä¸‹ã‚’è¨­å®š:

```env
# Discord
DISCORD_TOKEN=your_discord_bot_token

# GitHub
GITHUB_TOKEN=your_github_personal_access_token
GITHUB_REPO=yourusername/travel-data

# API Keys
WEATHER_API_KEY=your_openweathermap_key
CLAUDE_API_KEY=your_anthropic_api_key

# Botè¨­å®š
BOT_PREFIX=!
LOG_LEVEL=INFO
TIMEZONE=Asia/Tokyo
```

### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ‡ãƒ—ãƒ­ã‚¤ç¢ºèª

```bash
# Railway CLIã§ãƒ­ã‚°ç¢ºèªï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
npm install -g @railway/cli
railway login
railway logs
```

## è¨­å®šã¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### railway.jsonï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "pip install -r requirements.txt"
  },
  "deploy": {
    "startCommand": "python src/bot.py",
    "healthcheckPath": "/health",
    "healthcheckTimeout": 300,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè£…

```python
# src/health_server.py
from aiohttp import web
import asyncio

async def health(request):
    """ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ"""
    return web.json_response({
        'status': 'healthy',
        'bot_connected': bot.is_ready(),
        'latency': round(bot.latency * 1000, 2)
    })

async def start_health_server():
    app = web.Application()
    app.router.add_get('/health', health)
    runner = web.AppRunner(app)
    await runner.setup()
    site = web.TCPSite(runner, '0.0.0.0', 3000)
    await site.start()
```

### ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–

```python
# src/bot.py
import discord
from discord.ext import commands

# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’å‰Šæ¸›ã™ã‚‹Intentsè¨­å®š
intents = discord.Intents.default()
intents.message_content = True
intents.members = False  # ãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±ä¸è¦ãªå ´åˆ
intents.presences = False  # ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¹æƒ…å ±ä¸è¦

bot = commands.Bot(
    command_prefix='!',
    intents=intents,
    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚ºåˆ¶é™
    max_messages=100,
    member_cache_flags=discord.MemberCacheFlags.from_intents(intents)
)
```

## é‹ç”¨ãƒ»ç›£è¦–

### ãƒ­ã‚°ç®¡ç†

```python
# src/utils/logger.py
import logging
import sys

def setup_logger():
    """Railwayå‘ã‘ãƒ­ã‚°è¨­å®š"""
    logger = logging.getLogger('discord')
    logger.setLevel(logging.INFO)

    # Railwayã®ãƒ­ã‚°ã¯stdoutã«å‡ºåŠ›
    handler = logging.StreamHandler(sys.stdout)
    handler.setFormatter(logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    ))
    logger.addHandler(handler)

    return logger
```

### ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†

```python
# src/utils/metrics.py
import psutil
import discord

class BotMetrics:
    def __init__(self, bot):
        self.bot = bot

    async def get_metrics(self):
        """ç¾åœ¨ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å–å¾—"""
        process = psutil.Process()
        return {
            'cpu_percent': process.cpu_percent(),
            'memory_mb': process.memory_info().rss / 1024 / 1024,
            'latency_ms': round(self.bot.latency * 1000, 2),
            'guild_count': len(self.bot.guilds),
            'command_count': len(self.bot.commands)
        }
```

### è‡ªå‹•å†èµ·å‹•è¨­å®š

```python
# src/bot.py
import signal
import sys

def signal_handler(sig, frame):
    """ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³"""
    print('Shutting down gracefully...')
    asyncio.create_task(bot.close())
    sys.exit(0)

signal.signal(signal.SIGINT, signal_handler)
signal.signal(signal.SIGTERM, signal_handler)
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. Bot ãŒèµ·å‹•ã—ãªã„

```python
# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§è©³ç´°ãƒ­ã‚°å‡ºåŠ›
import os
os.environ['DISCORD_DEBUG'] = 'true'

# èµ·å‹•æ™‚ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒ
try:
    bot.run(TOKEN)
except Exception as e:
    print(f"Failed to start bot: {e}")
    # Railwayã¯éã‚¼ãƒ­çµ‚äº†ã‚³ãƒ¼ãƒ‰ã§å†èµ·å‹•ã‚’è©¦ã¿ã‚‹
    sys.exit(1)
```

#### 2. ãƒ¡ãƒ¢ãƒªä¸è¶³

```python
# ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å¼·åŒ–
import gc

@tasks.loop(minutes=30)
async def memory_cleanup():
    """å®šæœŸçš„ãªãƒ¡ãƒ¢ãƒªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—"""
    gc.collect()
    print(f"Memory cleaned. Current usage: {get_memory_usage()}MB")
```

#### 3. APIåˆ¶é™ã‚¨ãƒ©ãƒ¼

```python
# ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾ç­–
from discord.ext import commands
import asyncio

class RateLimitBucket:
    def __init__(self, rate, per):
        self.rate = rate
        self.per = per
        self.allowance = rate
        self.last_check = asyncio.get_event_loop().time()

    async def acquire(self):
        current = asyncio.get_event_loop().time()
        time_passed = current - self.last_check
        self.last_check = current
        self.allowance += time_passed * (self.rate / self.per)

        if self.allowance > self.rate:
            self.allowance = self.rate

        if self.allowance < 1.0:
            sleep_time = (1.0 - self.allowance) * (self.per / self.rate)
            await asyncio.sleep(sleep_time)
            self.allowance = 0.0
        else:
            self.allowance -= 1.0
```

### ãƒ‡ãƒ—ãƒ­ã‚¤å¤±æ•—æ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] requirements.txt ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒæ­£ã—ã„ã‹
- [ ] ç’°å¢ƒå¤‰æ•°ãŒã™ã¹ã¦è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¯¾å¿œã—ã¦ã„ã‚‹ã‹ï¼ˆ3.8ä»¥ä¸Šæ¨å¥¨ï¼‰
- [ ] GitHubé€£æºãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ãªã„ã‹

## ç§»è¡Œè¨ˆç”»

### Railway ã‹ã‚‰ä»–ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ç§»è¡Œåˆ¤æ–­åŸºæº–

```mermaid
graph TD
    A[ç¾çŠ¶è©•ä¾¡] --> B{æœˆé¡ã‚³ã‚¹ãƒˆ}
    B -->|$5ä»¥ä¸Š| C[VPSæ¤œè¨]
    B -->|$5æœªæº€| D{æ©Ÿèƒ½åˆ¶é™}
    D -->|å•é¡Œã‚ã‚Š| E[ä»–PaaSæ¤œè¨]
    D -->|å•é¡Œãªã—| F[Railwayç¶™ç¶š]

    C --> G[ã•ãã‚‰VPS/ConoHa]
    E --> H[Render/Fly.io]
```

### ç§»è¡Œå…ˆå€™è£œæ¯”è¼ƒ

| è¦ä»¶ | Railway | VPS | Render | Fly.io |
|-----|---------|-----|--------|--------|
| åˆæœŸè¨­å®š | â­ | â­â­â­â­ | â­â­ | â­â­â­ |
| æœˆé¡ã‚³ã‚¹ãƒˆ | $0.5-5 | 600å††ã€œ | $0-7 | $0-5 |
| ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ | â–³ | â— | â—‹ | â— |
| æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ | âœ— | âœ“ | â–³ | â–³ |
| Discord Botå¯¾å¿œ | â— | â—‹ | â—‹ | â—‹ |

### ãƒ‡ãƒ¼ã‚¿ç§»è¡Œæº–å‚™

```python
# src/utils/backup.py
import json
from datetime import datetime

class DataBackup:
    """ç§»è¡Œç”¨ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—"""

    async def export_data(self):
        """ã™ã¹ã¦ã®è¨­å®šã¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ"""
        backup = {
            'timestamp': datetime.utcnow().isoformat(),
            'version': '1.0',
            'settings': await self.get_all_settings(),
            'user_data': await self.get_user_data(),
            'templates': await self.get_templates()
        }

        with open('backup.json', 'w') as f:
            json.dump(backup, f, indent=2)

        return backup
```

## å‚è€ƒãƒªãƒ³ã‚¯

- [Railway å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.railway.app/)
- [Railway Discord Botãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](https://railway.app/templates?q=discord)
- [Railway æ–™é‡‘è¨ˆç®—ãƒ„ãƒ¼ãƒ«](https://railway.app/pricing)
- [Railway ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒšãƒ¼ã‚¸](https://status.railway.app/)
- [Railway ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£Discord](https://discord.gg/railway)

---

æœ€çµ‚æ›´æ–°: 2025å¹´1æœˆ
ä½œæˆè€…: TravelAssistanté–‹ç™ºãƒãƒ¼ãƒ 
